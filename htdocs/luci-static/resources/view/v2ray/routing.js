/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require uci";"require v2ray";"require view/v2ray/include/custom as custom";return L.view.extend({load:function(){return Promise.all([v2ray.getSections("routing_rule"),v2ray.getSections("routing_balancer","tag"),v2ray.getSections("inbound"),v2ray.getSections("inbound","tag"),v2ray.getSections("outbound"),v2ray.getSections("outbound","tag"),v2ray.getSections("dns","tag"),v2ray.getSections("reverse","bridges"),v2ray.getSections("reverse","portals"),v2ray.getCore()])},render:function(o){var t,e=void 0===o?[]:o,a=e[0],n=void 0===a?[]:a,r=e[1],i=void 0===r?[]:r,l=e[2],u=void 0===l?[]:l,s=e[3],d=void 0===s?[]:s,m=e[4],c=void 0===m?[]:m,v=e[5],g=void 0===v?[]:v,p=e[6],y=void 0===p?[]:p,f=e[7],h=void 0===f?[]:f,b=e[8],S=void 0===b?[]:b,D=e[9],I=void 0===D?"":D,L=new form.Map("v2ray","%s - %s".format(I,_("Routing")),_("Details: %s").format('<a href="https://xtls.github.io/config/routing.html#routingobject" target="_blank">RoutingObject</a>')),V=L.section(form.NamedSection,"main_routing","routing");V.anonymous=!0,V.addremove=!1,t=V.option(form.Flag,"enabled",_("Enabled")),(t=V.option(custom.RichListValue,"domain_strategy",_("Domain Matching Strategy"))).optional=!1,t.value("AsIs","AsIs",_("Match with the domain-based rules only.")),t.value("IPIfNonMatch","IPIfNonMatch",_("If no domain-based rules were matched, resolve domain and try matching with the </span>IP-based rules</span>.")),t.value("IPOnDemand","IPOnDemand",_("Whenever IP-based rules are encountered, resolve domain and match the rules using IP address immediately.")),(t=V.option(form.ListValue,"main_domain_matcher",_("Domain Matcher"))).value("hybrid"),t.value("linear"),t=V.option(form.MultiValue,"rules",_("Rules"),_("Select routing rules to use"));for(var M=0,P=n;M<P.length;M++){var R=P[M];t.value(R.value,R.caption)}t=V.option(form.MultiValue,"balancers",_("Balancers"),_("Select routing balancers to use"));for(var w=0,A=i;w<A.length;w++){R=A[w];t.value(R.value,R.caption)}var O=L.section(form.GridSection,"routing_rule",_("Routing Rule"),_("Add routing rules here"));O.sectiontitle=function(o){return uci.get("v2ray",o,"alias")},O.addremove=!0,O.sortable=!0,O.nodescription=!0,O.modaltitle=function(o){var t=uci.get("v2ray",o,"alias");return _("Routing Rule")+" > "+(null!=t?t:_("Add"))},(t=O.option(form.Value,"alias",_("Alias"))).rmempty=!1,t.modalonly=!0,(t=O.option(form.ListValue,"domain_matcher",_("Domain Matcher"))).value("hybrid"),t.value("linear"),t.modalonly=!0,(t=O.option(form.ListValue,"type",_("Type"))).value("field"),t.modalonly=!0,(t=O.option(form.DynamicList,"domain",_("Domain"))).modalonly=!0,(t=O.option(form.DynamicList,"ip",_("IP"))).modalonly=!0,(t=O.option(form.DynamicList,"port",_("Port"))).modalonly=!0,t.datatype="or(port, portrange)",(t=O.option(form.MultiValue,"network",_("Network"))).value("tcp"),t.value("udp"),(t=O.option(form.DynamicList,"source",_("Source"))).modalonly=!0,t.datatype="ipaddr",(t=O.option(form.DynamicList,"source_port",_("Source Port"))).modalonly=!0,t.datatype="or(port, portrange)",(t=O.option(form.DynamicList,"user",_("User"))).modalonly=!0,(t=O.option(form.MultiValue,"inbound_tag",_("Inbound Tag"))).value(y[0].caption,"DNS("+y[0].caption+")");for(var N=0;N<u.length;N++)t.value(d[N].caption,u[N].caption+"("+d[N].caption+")");for(var q=0,x=h;q<x.length;q++)for(var T=x[q],k=0,B=String(T.caption).split(",");k<B.length;k++){var j=B[k];t.value(j.substring(0,j.indexOf("|")),j)}(t=O.option(form.MultiValue,"protocol",_("Protocol"))).modalonly=!0,t.value("http"),t.value("tls"),t.value("bittorrent"),(t=O.option(form.DynamicList,"attrs",_("Attrs"))).modalonly=!0,t=O.option(form.ListValue,"outbound_tag",_("Outbound tag"));for(N=0;N<c.length;N++)t.value(g[N].caption,c[N].caption+"("+g[N].caption+")");for(var C=0,E=S;C<E.length;C++)for(var F=E[C],G=0,U=String(F.caption).split(",");G<U.length;G++){var W=U[G];t.value(W.substring(0,W.indexOf("|")),W)}(t=O.option(form.Value,"balancer_tag",_("Balancer tag"))).modalonly=!0,t.depends("outbound_tag","");var z=L.section(form.TypedSection,"routing_balancer",_("Routing Balancer",_("Add routing balancers here")));return z.anonymous=!0,z.addremove=!0,(t=z.option(form.Value,"tag",_("Tag"))).rmempty=!1,t=z.option(form.DynamicList,"selector",_("Selector")),L.render()}});