/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require v2ray";"require uci";return L.view.extend({load:function(){return Promise.all([v2ray.getSections("dns_server"),v2ray.getCore()])},render:function(e){var a,o=void 0===e?[]:e,r=o[0],t=void 0===r?[]:r,n=o[1],d=void 0===n?"":n,l=new form.Map("v2ray","%s - %s".format(d,_("DNS")),_("Details: %s").format('<a href="https://xtls.github.io/en/config/dns.html#dnsobject" target="_blank">DnsObject</a>')),i=l.section(form.NamedSection,"main_dns","dns");i.anonymous=!0,i.addremove=!1,(a=i.option(form.Flag,"enabled",_("Enabled"))).rmempty=!1,(a=i.option(form.Value,"tag",_("Tag"))).rmempty=!1,(a=i.option(form.Value,"client_ip",_("Client IP"),'<a href="https://icanhazip.com" target="_blank">%s</a>'.format(_("Get my public IP address")))).datatype="ipaddr",(a=i.option(form.DynamicList,"hosts",_("Hosts"),_("Host and domain mapping</br>format: <code>domain|ip1,ip2</code> or <code>domain-A|domain-B</code> eg: </br>%s or %s").format("<code>dns.google|8.8.8.8,8.8.4.4</code>","<code>google.cn|google.com</code>"))).validate=function(e,a){return!a||v2ray.v2rayValidation("hostmapping",a)},a.rmempty=!0,(a=i.option(form.ListValue,"query_strategy",_("Domain Strategy"))).value("UseIP"),a.value("UseIPv4"),a.value("UseIPv6"),(a=i.option(form.ListValue,"disable_cache",_("Disable DNS Cache"))).value("0",_("False")),a.value("1",_("True")),(a=i.option(form.ListValue,"disable_fallback",_("Disable Fallback Query"))).value("0",_("False")),a.value("1",_("True")),(a=i.option(form.ListValue,"disable_fallback_if_match",_("Disable Fallback if got Matches"))).value("0",_("False")),a.value("1",_("True")),a=i.option(form.MultiValue,"servers",_("DNS Servers"),_("Select DNS servers to use</br><code>Only 1 fakedns configuration can be enabled at the same time,prioritized by order</code>"));for(var s=0,u=t;s<u.length;s++){var p=u[s];a.value(p.value,p.caption)}var m=l.section(form.GridSection,"dns_server",_("DNS server"),_("Add DNS servers here"));return m.sectiontitle=function(e){return uci.get("v2ray",e,"alias")},m.modaltitle=function(e){var a=uci.get("v2ray",e,"alias");return _("DNS server")+" > "+(null!=a?a:_("Add"))},m.addremove=!0,m.nodescription=!0,m.sortable=!0,(a=m.option(form.Value,"alias",_("Alias"))).rmempty=!1,a.modalonly=!0,(a=m.option(form.ListValue,"dns_server_type",_("Type"))).value("DoH"),a.value("fakedns"),a.value("localhost"),a.value("QUIC"),a.value("TCP"),a.value("UDP"),(a=m.option(form.ListValue,"doh_provider","DoH Provider")).modalonly=!0,a.depends("dns_server_type","DoH"),a.value("8.8.8.8","Google"),a.value("1.1.1.1","Cloudflare"),a.value("dns.adguard-dns.com","adGuard"),(a=m.option(form.Value,"address",_("Address"))).depends("dns_server_type","QUIC"),a.depends("dns_server_type","TCP"),a.depends("dns_server_type","UDP"),(a=m.option(form.Value,"port",_("Port"))).depends("dns_server_type","TCP"),a.depends("dns_server_type","UDP"),a.depends("dns_server_type","QUIC"),a.modalonly=!0,a.datatype="port",a.placeholder="53",(a=m.option(form.Flag,"local_mode",_("Local Mode"),_("DNS Query through <code>Freedom</code> outbound"))).modalonly=!0,a.depends("dns_server_type","DoH"),a.depends("dns_server_type","TCP"),a.depends("dns_server_type","QUIC"),(a=m.option(form.DynamicList,"domains",_("Domains"))).validate=function(e,a){return!a||v2ray.v2rayValidation("domainrule",a)},a.modalonly=!0,(a=m.option(form.DynamicList,"expect_ips",_("Expect IPs"))).validate=function(e,a){return!a||v2ray.v2rayValidation("iprule",a)},a.modalonly=!0,(a=m.option(form.ListValue,"skip_fallback",_("Skip Fallback"))).modalonly=!0,a.value(""),a.value("0",_("False")),a.value("1",_("True")),(a=m.option(form.Value,"client_ip",_("Client IP"))).modalonly=!0,a.datatype="ipaddr",l.render()}});