/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require v2ray";"require uci";return L.view.extend({load:function(){return Promise.all([v2ray.getSections("dns_server"),v2ray.getCore()])},render:function(e){var o,a=void 0===e?[]:e,r=a[0],t=void 0===r?[]:r,n=a[1],d=void 0===n?"":n,l=new form.Map("v2ray","%s - %s".format(d,_("DNS")),_("Details: %s").format('<a href="https://xtls.github.io/en/config/dns.html#dnsobject" target="_blank">DnsObject</a>')),s=l.section(form.NamedSection,"main_dns","dns");s.anonymous=!0,s.addremove=!1,(o=s.option(form.Flag,"enabled",_("Enabled"))).rmempty=!1,(o=s.option(form.Value,"tag",_("Tag"))).rmempty=!1,(o=s.option(form.Value,"client_ip",_("Client IP"),'<a href="https://icanhazip.com" target="_blank">%s</a>'.format(_("Get my public IP address")))).datatype="ipaddr",(o=s.option(form.DynamicList,"hosts",_("Hosts"),_("Host and domain mapping</br>format: <code>domain|ip1,ip2</code> or <code>domain-A|domain-B</code> eg: </br>%s or %s").format("<code>dns.google|8.8.8.8,8.8.4.4</code>","<code>google.cn|google.com</code>"))).validate=function(e,o){return!o||v2ray.v2rayValidation("hostMapping",o)},o.rmempty=!0,(o=s.option(form.ListValue,"query_strategy",_("Domain Strategy"))).value("UseIP"),o.value("UseIPv4"),o.value("UseIPv6"),(o=s.option(form.ListValue,"disable_cache",_("Disable DNS Cache"))).value("0",_("False")),o.value("1",_("True")),(o=s.option(form.ListValue,"disable_fallback",_("Disable Fallback Query"))).value("0",_("False")),o.value("1",_("True")),(o=s.option(form.ListValue,"disable_fallback_if_match",_("Disable Fallback if got Matches"))).value("0",_("False")),o.value("1",_("True")),o=s.option(form.MultiValue,"servers",_("DNS Servers"),_("Select DNS servers to use</br><code>Only 1 fakedns configuration can be enabled at the same time,prioritized by order</code>"));for(var i=0,u=t;i<u.length;i++){var p=u[i];o.value(p.value,p.caption)}var m=l.section(form.GridSection,"dns_server",_("DNS server"),_("Add DNS servers here"));return m.sectiontitle=function(e){return uci.get("v2ray",e,"alias")},m.modaltitle=function(e){var o=uci.get("v2ray",e,"alias");return _("DNS server")+" > "+(null!=o?o:_("Add"))},m.addremove=!0,m.nodescription=!0,m.sortable=!0,(o=m.option(form.Value,"alias",_("Alias"))).rmempty=!1,o.modalonly=!0,(o=m.option(form.ListValue,"dns_server_type",_("Type"))).value("DoH"),o.value("fakedns"),o.value("localhost"),o.value("QUIC"),o.value("TCP"),o.value("UDP"),(o=m.option(form.ListValue,"doh_provider","DoH Provider")).modalonly=!0,o.depends("dns_server_type","DoH"),o.value("8.8.8.8","Google"),o.value("1.1.1.1","Cloudflare"),o.value("dns.adguard-dns.com","adGuard"),(o=m.option(form.Value,"address",_("Address"))).depends("dns_server_type","QUIC"),o.depends("dns_server_type","TCP"),o.depends("dns_server_type","UDP"),(o=m.option(form.Value,"port",_("Port"))).depends("dns_server_type","TCP"),o.depends("dns_server_type","UDP"),o.depends("dns_server_type","QUIC"),o.modalonly=!0,o.datatype="port",o.placeholder="53",(o=m.option(form.Flag,"local_mode",_("Local Mode"),_("DNS Query through <code>Freedom</code> outbound"))).modalonly=!0,o.depends("dns_server_type","DoH"),o.depends("dns_server_type","TCP"),o.depends("dns_server_type","QUIC"),(o=m.option(form.DynamicList,"domains",_("Domains"))).validate=function(e,o){return!o||(!!v2ray.domainRule(o)||_("Invalid domain/geosite/keyword/regular expression"))},o.modalonly=!0,(o=m.option(form.DynamicList,"expect_ips",_("Expect IPs"))).validate=function(e,o){return!o||(!!v2ray.ipRule(o)||_("Invalid IP address/CIDR/geoip."))},o.modalonly=!0,(o=m.option(form.ListValue,"skip_fallback",_("Skip Fallback"))).modalonly=!0,o.value(""),o.value("0",_("False")),o.value("1",_("True")),(o=m.option(form.Value,"client_ip",_("Client IP"))).modalonly=!0,o.datatype="ipaddr",l.render()}});