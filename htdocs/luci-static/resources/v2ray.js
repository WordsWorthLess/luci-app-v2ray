/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require fs";"require network";"require uci";return L.Class.extend({getLocalIPs:function(){return network.getNetworks().then((function(e){for(var r=["127.0.0.1","0.0.0.0","::"],t=0,n=e;t<n.length;t++){var a=n[t],s=a.getIPAddr(),i=a.getIP6Addr();s&&(s=s.split("/")[0])&&r.indexOf(s)<0&&r.push(s),i&&(i=i.split("/")[0])&&r.indexOf(i)<0&&r.push(i)}return r.sort()}))},getCore:function(){return uci.load("v2ray").then((function(){var e=uci.get("v2ray","main","core");e||(e="V2Ray")}))},getSections:function(e,r){return void 0===r&&(r="alias"),uci.load("v2ray").then((function(){var t=[];return uci.sections("v2ray",e,(function(e){var n=e[r];n&&t.push({caption:n,value:e[".name"]})})),t}))},getDokodemoDoorPorts:function(){return uci.load("v2ray").then((function(){var e=[];return uci.sections("v2ray","inbound",(function(r){var t;if("dokodemo-door"==r.protocol&&(t=r.port)){var n;(n=r.alias)?e.push({caption:"%s - %s".format(n,t),value:t}):e.push({caption:"%s:%s".format(r.listen,t),value:t})}})),e}))},getXtlsSecurity:function(){return uci.load("v2ray").then((function(){var e=[];return uci.sections("v2ray","v2ray",(function(r){"Xray"==r.core&&("1"==r.reality?e.push({security:["reality|REALITY"],flow:["xtls-rprx-vision","xtls-rprx-vision-udp443"]}):e.push({security:["xtls|XTLS"],flow:["xtls-rprx-direct","xtls-rprx-direct-udp443","xtls-rprx-origin","xtls-rprx-origin-udp443","xtls-rprx-splice","xtls-rprx-splice-udp443"]}))})),e}))},v2rayValidation:function(e,r){switch(e){case"wg-keys":return null!==r.match("^[a-zA-Z0-9/+]+=?=?$")&&r.length%4==0&&44===r.length||_("Invalid WireGuard key");case"wg-reserved":var t=r.match(/^(\d{1,3}),(\d{1,3}),(\d{1,3})$/);if(!t)return"%s:\n- %s\n  %s".format(_("Expecting"),_("'value1,value2,value3'"),_("each value should be an integer between 0-255"));var n=t.map(Number);return!![n[1],n[2],n[3]].every((function(e){return e>=0&&e<=255}))||"%s:\n- %s\n  %s".format(_("Expecting"),_("'value1,value2,value3'"),_("each value should be an integer between 0-255"));case"fragment-length":if(/^\d+$/.test(r)&&parseInt(r)>0)return!0;var a=r.split("-"),s=parseInt(a[0]),i=parseInt(a[1]);return s>0&&i>s||"%s: %s:\n- %s\n- %s".format(_("Expecting"),_("One of the following"),_("Integers greater than 0"),_("A range of integers which are greater than 0"));case"fragment-interval":if(/^\d+$/.test(r)&&parseInt(r)>0)return!0;if(/^\d+-\d+$/.test(r)){var o=r.split("-"),u=parseInt(o[0]),c=parseInt(o[1]);if(u>0&&c>u)return!0}return"%s: %s:\n- %s\n- %s".format(_("Expecting"),_("One of the following"),_("Integers greater than 0"),_("A range of integers which are greater than 0"));case"fragment-packets":if(/^\d+$/.test(r)&&parseInt(r)>0)return!0;if(/^\d+-\d+$/.test(r)){var l=r.split("-"),f=parseInt(l[0]),p=parseInt(l[1]);if(f>0&&p>f)return!0}return"tlshello"===r||"%s: %s:\n - %s\n   %s\n - %s\n   %s".format(_("Expecting"),_("One of the following"),_("Integers greater than 0, corresponding to the packet index"),_("eg: '5' for the fifth packet'"),_("A range of integers which are greater than 0"),_("eg: '1-3' for the 1st to 3rd packets"));default:return _("Unknown Data")}}});