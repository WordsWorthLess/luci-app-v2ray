/**
 * @license
 * Copyright 2020 Xingwang Liao <kuoruan@gmail.com>
 *
 * Licensed to the public under the MIT License.
 */
"use strict";"require form";"require uci";"require v2ray";"require ui";"require view/v2ray/include/custom as custom";"require view/v2ray/tools/converters as converters";return L.view.extend({handleImportSave:function(e){for(var s=e.split(/\r?\n/),o=0,t=0,a=s;t<a.length;t++){var r=a[t],l=void 0;if(r&&(l=converters.vmessLinkToVmess(r))&&"2"===l.v){var n=uci.add("v2ray","outbound");if(n){var d=l.add||"0.0.0.0",p=l.port||"0",i=l.tls||"",m=l.net||"",u=l.type||"",c=l.path||"",v=l.ps||"%s:%s".format(d,p);uci.set("v2ray",n,"alias",v),uci.set("v2ray",n,"protocol","vmess"),uci.set("v2ray",n,"s_vmess_address",d),uci.set("v2ray",n,"s_vmess_port",p),uci.set("v2ray",n,"s_vmess_user_id",l.id||""),uci.set("v2ray",n,"s_vmess_user_alter_id",l.aid||""),uci.set("v2ray",n,"ss_security",i);var y=[];switch(l.host&&(y=l.host.split(",")),m){case"tcp":uci.set("v2ray",n,"ss_network","tcp"),uci.set("v2ray",n,"ss_tcp_header_type",u),"http"===u&&y.length>0&&(uci.set("v2ray",n,"ss_tcp_header_request_headers",["Host=%s".format(y[0])]),"tls"===i&&uci.set("v2ray",n,"ss_tls_server_name",y[0]));break;case"kcp":case"mkcp":uci.set("v2ray",n,"ss_network","kcp"),uci.set("v2ray",n,"ss_kcp_header_type",u);break;case"ws":uci.set("v2ray",n,"ss_network","ws"),uci.set("v2ray",n,"ss_websocket_path",c);break;case"http":case"h2":uci.set("v2ray",n,"ss_network","http"),uci.set("v2ray",n,"ss_http_path",c),y.length>0&&(uci.set("v2ray",n,"ss_http_host",y),uci.set("v2ray",n,"ss_tls_server_name",y[0]));break;case"quic":uci.set("v2ray",n,"ss_network","quic"),uci.set("v2ray",n,"ss_quic_header_type",u),uci.set("v2ray",n,"ss_quic_key",c),y.length>0&&(uci.set("v2ray",n,"ss_quic_security",y[0]),"tls"===i&&uci.set("v2ray",n,"ss_tls_server_name",y[0]));break;default:uci.remove("v2ray",n);continue}o++}}}if(o>0)return uci.save().then((function(){ui.showModal(_("Outbound Import"),[E("p",{},_("Imported %d links.").format(o)),E("div",{class:"right"},E("button",{class:"btn",click:ui.createHandlerFn(this,(function(){return uci.apply().then((function(){ui.hideModal(),window.location.reload()}))}))},_("OK")))])}));ui.showModal(_("Outbound Import"),[E("p",{},_("No links imported.")),E("div",{class:"right"},E("button",{class:"btn",click:ui.hideModal},_("OK")))])},handleImportClick:function(){var e=new ui.Textarea("",{rows:10,placeholder:_("You can add multiple links at once, one link per line."),validate:function(e){return e?!!/^(vmess:\/\/[a-zA-Z0-9/+=]+\s*)+$/i.test(e)||_("Invalid links."):_("Empty field.")}});ui.showModal(_("Import Vmess Links"),[E("div",{},[E("p",{},_("Allowed link format: <code>%s</code>").format("vmess://xxxxx")),e.render()]),E("div",{class:"right"},[E("button",{class:"btn",click:ui.hideModal},_("Dismiss"))," ",E("button",{class:"cbi-button cbi-button-positive important",click:ui.createHandlerFn(this,(function(e){var s;if(e.triggerValidation(),e.isValid()&&(s=e.getValue())&&(s=s.trim()))return this.handleImportSave(s)}),e)},_("Save"))])])},load:function(){return Promise.all([v2ray.getLocalIPs(),v2ray.getSections("inbound","alias"),v2ray.getSections("inbound","tag"),v2ray.getSections("outbound","alias"),v2ray.getSections("outbound","tag"),v2ray.getSections("reverse","bridges"),v2ray.getSections("reverse","portals")])},render:function(e){var s,o=e[0],t=void 0===o?[]:o,a=e[1],r=void 0===a?[]:a,l=e[2],n=void 0===l?[]:l,d=e[3],p=void 0===d?[]:d,i=e[4],m=void 0===i?[]:i,u=e[5],c=void 0===u?[]:u,v=e[6],y=void 0===v?[]:v,f=new form.Map("v2ray","%s - %s".format(_("V2Ray"),_("Outbound"))),h=f.section(form.GridSection,"outbound");h.anonymous=!1,h.addremove=!0,h.sortable=!0,h.modaltitle=function(e){var s=uci.get("v2ray",e,"alias");return _("Outbound")+" Â» "+(null!=s?s:_("Add"))},h.nodescriptions=!0,h.tab("general",_("General Settings")),h.tab("stream",_("Stream Settings")),h.tab("other",_("Other Settings")),(s=h.taboption("general",form.Value,"alias",_("Alias"))).rmempty=!1,(s=h.taboption("general",form.Value,"send_through",_("Send through"))).datatype="ipaddr";for(var b=0,g=t;b<g.length;b++){var k=g[b];s.value(k)}(s=h.taboption("general",form.ListValue,"protocol",_("Protocol"))).value("blackhole","Blackhole"),s.value("dns","DNS"),s.value("freedom","Freedom"),s.value("http","HTTP/2"),s.value("loopback"),s.value("mtproto","MTProto"),s.value("shadowsocks","Shadowsocks"),s.value("socks","Socks"),s.value("trojan","Trojan"),s.value("vless","VLESS"),s.value("vmess","VMess"),(s=h.taboption("general",form.ListValue,"s_blackhole_reponse_type","%s - %s".format("Blackhole",_("Response type")))).modalonly=!0,s.depends("protocol","blackhole"),s.value(""),s.value("none",_("None")),s.value("http","HTTP"),(s=h.taboption("general",form.ListValue,"s_dns_network","%s - %s".format("DNS",_("Network")))).modalonly=!0,s.depends("protocol","dns"),s.value(""),s.value("tcp","TCP"),s.value("udp","UDP"),(s=h.taboption("general",form.Value,"s_dns_address","%s - %s".format("DNS",_("Address")))).modalonly=!0,s.depends("protocol","dns"),(s=h.taboption("general",form.Value,"s_dns_port","%s - %s".format("DNS",_("Port")))).modalonly=!0,s.depends("protocol","dns"),s.datatype="port",(s=h.taboption("general",form.ListValue,"s_freedom_domain_strategy","%s - %s".format("Freedom",_("Domain strategy")))).modalonly=!0,s.depends("protocol","freedom"),s.value(""),s.value("AsIs"),s.value("UseIP"),s.value("UseIPv4"),s.value("UseIPv6"),(s=h.taboption("general",form.Value,"s_freedom_redirect","%s - %s".format("Freedom",_("Redirect")))).modalonly=!0,s.depends("protocol","freedom"),(s=h.taboption("general",form.Value,"s_freedom_user_level","%s - %s".format("Freedom",_("User level")))).modalonly=!0,s.depends("protocol","freedom"),s.datatype="uinteger",(s=h.taboption("general",form.Value,"s_http_server_address","%s - %s".format("HTTP",_("Server address")))).modalonly=!0,s.depends("protocol","http"),s.datatype="host",(s=h.taboption("general",form.Value,"s_http_server_port","%s - %s".format("HTTP",_("Server port")))).modalonly=!0,s.depends("protocol","http"),s.datatype="port",(s=h.taboption("general",form.Value,"s_http_account_user","%s - %s".format("HTTP",_("User")))).modalonly=!0,s.depends("protocol","http"),(s=h.taboption("general",form.Value,"s_http_account_pass","%s - %s".format("HTTP",_("Password")))).modalonly=!0,s.depends("protocol","http"),s.password=!0,(s=h.taboption("general",form.ListValue,"s_loopback_inboundtag","%s - %s".format("Loopback",_("Inbound Tag")))).modalonly=!0,s.depends("protocol","loopback"),s.value("",_("None"));for(var w=0;w<r.length;w++)s.value(n[w].caption,r[w].caption+"("+n[w].caption+")");for(var V=0,S=c;V<S.length;V++)for(var T=S[V],P=0,x=String(T.caption).split(",");P<x.length;P++){var C=x[P];s.value(C.substring(0,C.indexOf("|")),C)}(s=h.taboption("general",form.Value,"s_shadowsocks_email","%s - %s".format("Shadowsocks",_("Email")))).modalonly=!0,s.depends("protocol","shadowsocks"),(s=h.taboption("general",form.Value,"s_shadowsocks_address","%s - %s".format("Shadowsocks",_("Address")))).modalonly=!0,s.depends("protocol","shadowsocks"),s.datatype="host",(s=h.taboption("general",form.Value,"s_shadowsocks_port","%s - %s".format("Shadowsocks",_("Port")))).modalonly=!0,s.depends("protocol","shadowsocks"),s.datatype="port",(s=h.taboption("general",form.ListValue,"s_shadowsocks_method","%s - %s".format("Shadowsocks",_("Method")))).modalonly=!0,s.depends("protocol","shadowsocks"),s.value(""),s.value("aes-256-cfb"),s.value("aes-128-cfb"),s.value("chacha20"),s.value("chacha20-ietf"),s.value("aes-256-gcm"),s.value("aes-128-gcm"),s.value("chacha20-poly1305"),s.value("chacha20-ietf-poly1305"),(s=h.taboption("general",form.Value,"s_shadowsocks_password","%s - %s".format("Shadowsocks",_("Password")))).modalonly=!0,s.depends("protocol","shadowsocks"),s.password=!0,(s=h.taboption("general",form.Value,"s_shadowsocks_level","%s - %s".format("Shadowsocks",_("User level")))).modalonly=!0,s.depends("protocol","shadowsocks"),s.datatype="uinteger",(s=h.taboption("general",form.Flag,"s_shadowsocks_ota","%s - %s".format("Shadowsocks",_("OTA")))).modalonly=!0,s.depends("protocol","shadowsocks"),(s=h.taboption("general",form.Value,"s_socks_server_address","%s - %s".format("Socks",_("Server address")))).modalonly=!0,s.depends("protocol","socks"),s.datatype="host",(s=h.taboption("general",form.Value,"s_socks_server_port","%s - %s".format("Socks",_("Server port")))).modalonly=!0,s.depends("protocol","socks"),s.datatype="port",(s=h.taboption("general",form.Value,"s_socks_account_user","%s - %s".format("Socks",_("User")))).modalonly=!0,s.depends("protocol","socks"),(s=h.taboption("general",form.Value,"s_socks_account_pass","%s - %s".format("Socks",_("Password")))).modalonly=!0,s.depends("protocol","socks"),s.password=!0,(s=h.taboption("general",form.Value,"s_socks_user_level","%s - %s".format("Socks",_("User level")))).modalonly=!0,s.depends("protocol","socks"),s.datatype="uinteger",(s=h.taboption("general",form.Value,"s_trojan_address","%s - %s".format("Trojan",_("Address")))).depends("protocol","trojan"),s.modalonly=!0,s.datatype="host",(s=h.taboption("general",form.Value,"s_trojan_port","%s - %s".format("Trojan",_("Port")))).depends("protocol","trojan"),s.modalonly=!0,s.datatype="port",(s=h.taboption("general",form.Value,"s_trojan_password","%s - %s".format("Trojan",_("Password")))).depends("protocol","trojan"),s.modalonly=!0,(s=h.taboption("general",form.Value,"s_vless_address","%s - %s".format("VLESS",_("Address")))).depends("protocol","vless"),s.modalonly=!0,s.datatype="host",(s=h.taboption("general",form.Value,"s_vless_port","%s - %s".format("VLESS",_("Port")))).depends("protocol","vless"),s.modalonly=!0,s.datatype="port",(s=h.taboption("general",form.Value,"s_vless_user_id","%s - %s".format("VLESS",_("User ID")))).modalonly=!0,s.depends("protocol","vless"),(s=h.taboption("general",form.Value,"s_vless_user_level","%s - %s".format("VLESS",_("User Level")))).modalonly=!0,s.depends("protocol","vless"),s.datatype="and(uinteger, max(10))",(s=h.taboption("general",form.ListValue,"s_vless_user_encryption","%s - %s".format("VLESS",_("Encryption")))).modalonly=!0,s.depends("protocol","vless"),s.value("none"),(s=h.taboption("general",form.Value,"s_vmess_address","%s - %s".format("VMess",_("Address")))).modalonly=!0,s.depends("protocol","vmess"),s.datatype="host",(s=h.taboption("general",form.Value,"s_vmess_port","%s - %s".format("VMess",_("Port")))).modalonly=!0,s.depends("protocol","vmess"),s.datatype="port",(s=h.taboption("general",form.Value,"s_vmess_user_id","%s - %s".format("VMess",_("User ID")))).modalonly=!0,s.depends("protocol","vmess"),(s=h.taboption("general",form.Value,"s_vmess_user_alter_id","%s - %s".format("VMess",_("Alter ID")))).modalonly=!0,s.depends("protocol","vmess"),s.datatype="and(uinteger, max(65535))",(s=h.taboption("general",form.ListValue,"s_vmess_user_security","%s - %s".format("VMess",_("Security")))).modalonly=!0,s.depends("protocol","vmess"),s.value(""),s.value("auto",_("Auto")),s.value("aes-128-gcm"),s.value("chacha20-poly1305"),s.value("none",_("None")),(s=h.taboption("general",form.Value,"s_vmess_user_level","%s - %s".format("VMess",_("User level")))).modalonly=!0,s.depends("protocol","vmess"),s.datatype="uinteger",(s=h.taboption("stream",form.ListValue,"ss_network",_("Network"))).value(""),s.value("grpc","gRPC"),s.value("tcp","TCP"),s.value("kcp","mKCP"),s.value("ws","WebSocket"),s.value("h2","HTTP/2"),s.value("domainsocket","Domain Socket"),s.value("quic","QUIC"),(s=h.taboption("stream",form.ListValue,"ss_security",_("Security"))).modalonly=!0,s.value("none",_("None")),s.value("reality","REALITY"),s.value("tls","(x)TLS"),(s=h.taboption("stream",form.Flag,"ss_xtls_enabled","%s - %s".format("xTLS",_("Enable")),_('xTLS <span style="text-decoration:underline;color: #ec8717;">Only</span> works under <span style="text-decoration:underline;color: #ec8717;">"Trojan/VLESS"</span> protocols through <span style="text-decoration:underline;color: #ec8717;">"TCP/mKCP/DomainSocket"</span> transportations'))).modalonly=!0,s.depends("ss_security","tls"),s.enabled="1",s.disabled="0",(s=h.taboption("stream",form.ListValue,"s_xtls_flow","Flow")).modalonly=!0,s.depends("ss_xtls_enabled","1"),s.depends("ss_security","reality"),s.value("",_("none")),s.value("xtls-rprx-vision"),s.value("xtls-rprx-vision-udp443"),(s=h.taboption("stream",form.Value,"ss_tls_server_name","%s - %s".format("(x)TLS",_("Server name")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.MultiValue,"ss_tls_alpn","%s - %s".format("(x)TLS","ALPN"))).modalonly=!0,s.depends("ss_security","tls"),s.value("h2"),s.value("http/1.1"),(s=h.taboption("stream",form.Flag,"ss_tls_allow_insecure","%s - %s".format("(x)TLS",_("Allow insecure")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.Flag,"ss_tls_allow_insecure_ciphers","%s - %s".format("(x)TLS",_("Allow insecure ciphers")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.Flag,"ss_tls_disable_system_root","%s - %s".format("(x)TLS",_("Disable system root")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.ListValue,"ss_tls_cert_usage","%s - %s".format("(x)TLS",_("Certificate usage")))).modalonly=!0,s.depends("ss_security","tls"),s.value(""),s.value("encipherment"),s.value("verify"),s.value("issue"),(s=h.taboption("stream",form.Value,"ss_tls_cert_fiile","%s - %s".format("(x)TLS",_("Certificate file")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.Value,"ss_tls_key_file","%s - %s".format("(x)TLS",_("Key file")))).modalonly=!0,s.depends("ss_security","tls"),(s=h.taboption("stream",form.ListValue,"ss_reality_show","%s - %s".format("Debug",_("Info")),_("Show REALITY Debug Info in LOGs"))).modalonly=!0,s.depends("ss_security","reality"),s.value("1",_("Show")),s.value("0",_("Hide")),(s=h.taboption("stream",form.ListValue,"ss_reality_fingerprint",_("fingerprint"))).modalonly=!0,s.depends("ss_security","reality"),s.depends("ss_security","tls"),s.value("","none"),s.value("360"),s.value("android"),s.value("chrome"),s.value("edge"),s.value("firefox"),s.value("ios"),s.value("qq"),s.value("random"),s.value("randomized"),s.value("safari"),(s=h.taboption("stream",form.Value,"ss_reality_server_name",_("Server Name"))).modalonly=!0,s.datatype="hostname",s.depends("ss_security","reality"),s.placeholder="example.com",(s=h.taboption("stream",form.Value,"ss_reality_public_key",_("Public Key"))).modalonly=!0,s.depends("ss_security","reality"),s.datatype="rangelength(43, 43)",(s=h.taboption("stream",form.Value,"ss_reality_short_id",_("Short ID"))).modalonly=!0,s.depends("ss_security","reality"),s.datatype="and(hexstring, maxlength(16))",s.rmempty=!0,(s=h.taboption("stream",form.Value,"ss_reality_spiderx",_("Spider Parameters"))).modalonly=!0,s.depends("ss_security","reality"),s.rmempty=!0,(s=h.taboption("stream",form.ListValue,"ss_tcp_header_type","%s - %s".format("TCP",_("Header type")))).modalonly=!0,s.depends("ss_network","tcp"),s.value(""),s.value("none",_("None")),s.value("http","HTTP"),(s=h.taboption("stream",form.Value,"ss_tcp_header_request_version","%s - %s".format("TCP",_("HTTP request version")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.ListValue,"ss_tcp_header_request_method","%s - %s".format("TCP",_("HTTP request method")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),s.value(""),s.value("GET"),s.value("HEAD"),s.value("POST"),s.value("DELETE"),s.value("PUT"),s.value("PATCH"),s.value("OPTIONS"),(s=h.taboption("stream",form.Value,"ss_tcp_header_request_path","%s - %s".format("TCP",_("Request path")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.DynamicList,"ss_tcp_header_request_headers","%s - %s".format("TCP",_("Request headers")),_("A list of HTTP headers, format: <code>header=value</code>. eg: %s").format("Host=www.bing.com"))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.Value,"ss_tcp_header_response_version","%s - %s".format("TCP",_("HTTP response version")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.Value,"ss_tcp_header_response_status","%s - %s".format("TCP",_("HTTP response status")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.Value,"ss_tcp_header_response_reason","%s - %s".format("TCP",_("HTTP response reason")))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.DynamicList,"ss_tcp_header_response_headers","%s - %s".format("TCP",_("Response headers")),_("A list of HTTP headers, format: <code>header=value</code>. eg: %s").format("Host=www.bing.com"))).modalonly=!0,s.depends("ss_tcp_header_type","http"),(s=h.taboption("stream",form.Value,"ss_kcp_mtu","%s - %s".format("mKCP",_("Maximum transmission unit (MTU)")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="and(min(576), max(1460))",s.placeholder="1350",(s=h.taboption("stream",form.Value,"ss_kcp_tti","%s - %s".format("mKCP",_("Transmission time interval (TTI)")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="and(min(10), max(100))",s.placeholder="50",(s=h.taboption("stream",form.Value,"ss_kcp_uplink_capacity","%s - %s".format("mKCP",_("Uplink capacity")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="uinteger",s.placeholder="5",(s=h.taboption("stream",form.Value,"ss_kcp_downlink_capacity","%s - %s".format("mKCP",_("Downlink capacity")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="uinteger",s.placeholder="20",(s=h.taboption("stream",form.Flag,"ss_kcp_congestion","%s - %s".format("mKCP",_("Congestion enabled")))).modalonly=!0,s.depends("ss_network","kcp"),(s=h.taboption("stream",form.Value,"ss_kcp_read_buffer_size","%s - %s".format("mKCP",_("Read buffer size")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="uinteger",s.placeholder="2",(s=h.taboption("stream",form.Value,"ss_kcp_write_buffer_size","%s - %s".format("mKCP",_("Write buffer size")))).modalonly=!0,s.depends("ss_network","kcp"),s.datatype="uinteger",s.placeholder="2",(s=h.taboption("stream",form.ListValue,"ss_kcp_header_type","%s - %s".format("mKCP",_("Header type")))).modalonly=!0,s.depends("ss_network","kcp"),s.value(""),s.value("none",_("None")),s.value("srtp","SRTP"),s.value("utp","uTP"),s.value("wechat-video",_("Wechat Video")),s.value("dtls","DTLS 1.2"),s.value("wireguard","WireGuard"),(s=h.taboption("stream",form.Value,"ss_websocket_path","%s - %s".format("WebSocket",_("Path")))).modalonly=!0,s.depends("ss_network","ws"),(s=h.taboption("stream",form.DynamicList,"ss_websocket_headers","%s - %s".format("WebSocket",_("Headers")),_("A list of HTTP headers, format: <code>header=value</code>. eg: %s").format("Host=www.bing.com"))).modalonly=!0,s.depends("ss_network","ws"),(s=h.taboption("stream",form.Value,"ss_grpc_service_name","%s %s".format(_("Service"),_("Name")))).modalonly=!0,s.depends("ss_network","grpc"),s.placeholder="gRPC_Service",(s=h.taboption("stream",form.ListValue,"ss_grpc_multi_mode","%s %s".format("gRPC",_("Mode")))).modalonly=!0,s.depends("ss_network","grpc"),s.value("0","gun"),s.value("1","Multi"),(s=h.taboption("stream",form.ListValue,"ss_grpc_permit_without_stream",_("Health Check"))).modalonly=!0,s.depends("ss_network","grpc"),s.value("0",_("Disabled")),s.value("1",_("Enabled")),(s=h.taboption("stream",form.Value,"ss_grpc_idle_timeout",_("Idle Timeout"),_("No less than 10 seconds"))).modalonly=!0,s.depends("ss_network","grpc"),s.datatype="and(min(10), uinteger)",s.placeholder="10",(s=h.taboption("stream",form.Value,"ss_grpc_health_check_timeout",_("Health Check timeout"))).modalonly=!0,s.depends("ss_grpc_permit_without_stream","true"),s.datatype="and(min(10), uinteger)",s.placeholder="20",(s=h.taboption("stream",form.Value,"ss_grpc_initial_windows_size",_("Initial Windows Size"),_("While connecting through Cloudflare CDN</br> set Initial Windows Size greater than <code>35536</code> to disable Dynamic Window mechanism"))).modalonly=!0,s.depends("ss_network","grpc"),s.datatype="uinteger",(s=h.taboption("stream",form.DynamicList,"ss_http_host","%s - %s".format("HTTP/2",_("Host")))).modalonly=!0,s.depends("ss_network","h2"),(s=h.taboption("stream",form.Value,"ss_http_path","%s - %s".format("HTTP/2",_("Path")))).modalonly=!0,s.depends("ss_network","h2"),s.placeholder="/",(s=h.taboption("stream",form.Value,"ss_domainsocket_path","%s - %s".format("Domain Socket",_("Path")))).modalonly=!0,s.depends("ss_network","domainsocket"),(s=h.taboption("stream",form.ListValue,"ss_quic_security","%s - %s".format("QUIC",_("Security")))).modalonly=!0,s.depends("ss_network","quic"),s.value(""),s.value("none",_("None")),s.value("aes-128-gcm"),s.value("chacha20-poly1305"),(s=h.taboption("stream",form.Value,"ss_quic_key","%s - %s".format("QUIC",_("Key")))).modalonly=!0,s.depends("ss_quic_security","aes-128-gcm"),s.depends("ss_quic_security","chacha20-poly1305"),(s=h.taboption("stream",form.ListValue,"ss_quic_header_type","%s - %s".format("QUIC",_("Header type")))).modalonly=!0,s.depends("ss_network","quic"),s.value(""),s.value("none",_("None")),s.value("srtp","SRTP"),s.value("utp","uTP"),s.value("wechat-video",_("Wechat Video")),s.value("dtls","DTLS 1.2"),s.value("wireguard","WireGuard"),(s=h.taboption("stream",form.Value,"ss_sockopt_mark","%s - %s".format(_("Sockopt"),_("Mark")),_("If transparent proxy is enabled, this option is ignored and will be set to 255."))).modalonly=!0,s.placeholder="255",(s=h.taboption("stream",form.ListValue,"ss_sockopt_domain_strategy","%s - %s".format(_("Sockopt"),_("Domain strategy")))).modalonly=!0,s.depends("protocol","http"),s.depends("protocol","loopback"),s.depends("protocol","mtproto"),s.depends("protocol","shadowsocks"),s.depends("protocol","socks"),s.depends("protocol","trojan"),s.depends("protocol","vless"),s.depends("protocol","vmess"),s.value("AsIs"),s.value("UseIP"),s.value("UseIPv4"),s.value("UseIPv6"),(s=h.taboption("stream",form.ListValue,"ss_sockopt_tcp_fast_open","%s - %s".format(_("Sockopt"),_("TCP fast open")))).modalonly=!0,s.value(""),s.value("0",_("False")),s.value("1",_("True")),(s=h.taboption("general",form.Value,"tag",_("Tag"))).rmempty=!1,(s=h.taboption("general",form.ListValue,"proxy_settings_tag","%s - %s".format(_("Proxy settings"),_("Tag")))).modalonly=!0,s.value("",_("None"));for(w=0;w<p.length;w++)s.value(m[w].caption,p[w].caption+"("+m[w].caption+")");for(var I=0,H=y;I<H.length;I++)for(var q=H[I],D=0,A=String(q.caption).split(",");D<A.length;D++){var M=A[D];s.value(M.substring(0,M.indexOf("|")),M)}(s=h.taboption("other",form.Flag,"mux_enabled","%s - %s".format(_("Mux"),_("Enabled")))).modalonly=!0,s.depends({ss_network:"ws",ss_security:"tls",ss_xtls_enabled:"0"}),s.depends({ss_network:"tcp",ss_security:"tls",ss_xtls_enabled:"0"}),s.depends({ss_network:"grpc",ss_security:"tls",ss_xtls_enabled:"0"}),s.depends({ss_network:"h2",ss_security:"tls",ss_xtls_enabled:"0"}),s.depends({ss_network:"ws",ss_security:"none"}),s.depends({ss_network:"tcp",ss_security:"none"}),s.depends({ss_network:"grpc",ss_security:"none"}),s.depends({ss_network:"h2",ss_security:"none"}),s.enabled="1",s.disabled="0",(s=h.taboption("other",form.Value,"mux_concurrency","%s - %s".format(_("Mux"),_("Concurrency")))).modalonly=!0,s.depends("mux_enabled","1"),s.datatype="uinteger",s.placeholder="8";var U=this;return f.render().then((function(e){var s=f.findElement("id","cbi-v2ray-outbound"),o=E("div",{class:"cbi-section-create cbi-tblsection-create"},E("button",{class:"cbi-button cbi-button-neutral",title:_("Import"),click:L.bind(U.handleImportClick,U)},_("Import")));return L.dom.append(s,o),e}))}});